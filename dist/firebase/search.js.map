{"version":3,"sources":["../../server/firebase/search.js"],"names":["searchForUsers","queryItem","db","collection","orderBy","adminFirestore","firestore","FieldPath","documentId","startAt","endAt","limit","get","then","snapshot","isEmpty","resultArray","forEach","doc","userData","data","hashedPassword","push","searchSuggested","result","username","getUsersWithNotificationToken","where","module","exports"],"mappings":";;AAAA;;;;AACA;;;;AAEA,IAAMA,iBAAiB,SAAjBA,cAAiB,CAACC,SAAD,EAAe;AACpC,SAAOC,UAAGC,UAAH,CAAc,OAAd,EAAuBC,OAAvB,CAA+BC,wBAAeC,SAAf,CAAyBC,SAAzB,CAAmCC,UAAnC,EAA/B,EACJC,OADI,CACIR,SADJ,EAEJS,KAFI,CAEKT,SAFL,aAGJU,KAHI,CAGE,EAHF,EAIJC,GAJI,GAKJC,IALI,CAKC,UAACC,QAAD,EAAc;AAClB,QAAIA,SAASC,OAAb,EAAsB,OAAO,EAAP;;AAEtB,QAAMC,cAAc,EAApB;;AAEAF,aAASG,OAAT,CAAiB,UAACC,GAAD,EAAS;AACxB,UAAMC,WAAWD,IAAIE,IAAJ,EAAjB;AACA,aAAOD,SAASE,cAAhB;;AAEAL,kBAAYM,IAAZ,CAAiBH,QAAjB;AACD,KALD;;AAOA,WAAOH,WAAP;AACD,GAlBI,CAAP;AAmBD,CApBD;;AAuBA,IAAMO,kBAAkB,SAAlBA,eAAkB,GAAM;AAC5B,SAAOrB,UAAGC,UAAH,CAAc,OAAd,EAAuBQ,KAAvB,CAA6B,EAA7B,EAAiCC,GAAjC,GAAuCC,IAAvC,CAA4C,UAACC,QAAD,EAAc;AAC/D,QAAMU,SAAS,EAAf;AACAV,aAASG,OAAT,CAAiB,UAACC,GAAD,EAAS;AACxB,UAAMC,WAAWD,IAAIE,IAAJ,EAAjB;AACA,aAAOD,SAASE,cAAhB;;AAEAG,aAAOL,SAASM,QAAhB,IAA4BN,QAA5B;AACD,KALD;;AAOA,WAAOK,MAAP;AACD,GAVM,CAAP;AAWD,CAZD;;AAeA,IAAME,gCAAgC,SAAhCA,6BAAgC,GAAM;AAC1C,SAAOxB,UAAGC,UAAH,CAAc,OAAd,EAAuBwB,KAAvB,CAA6B,mBAA7B,EAAkD,GAAlD,EAAuD,EAAvD,EAA2Df,GAA3D,GACJC,IADI,CACC,UAACC,QAAD,EAAc;AAClB,QAAMU,SAAS,EAAf;AACAV,aAASG,OAAT,CAAiB,UAACC,GAAD,EAAS;AACxB,UAAMC,WAAWD,IAAIE,IAAJ,EAAjB;AACA,aAAOD,SAASE,cAAhB;;AAEAG,aAAOL,SAASM,QAAhB,IAA4BN,QAA5B;AACD,KALD;AAMA,WAAOK,MAAP;AACD,GAVI,CAAP;AAWD,CAZD;;AAeAI,OAAOC,OAAP,GAAiB,EAAE7B,8BAAF,EAAkBuB,gCAAlB,EAAmCG,4DAAnC,EAAjB","file":"search.js","sourcesContent":["import adminFirestore from 'firebase-admin';\nimport { db } from './index';\n\nconst searchForUsers = (queryItem) => {\n  return db.collection('users').orderBy(adminFirestore.firestore.FieldPath.documentId())\n    .startAt(queryItem)\n    .endAt(`${queryItem}\\uf8ff`)\n    .limit(10)\n    .get()\n    .then((snapshot) => {\n      if (snapshot.isEmpty) return [];\n\n      const resultArray = [];\n\n      snapshot.forEach((doc) => {\n        const userData = doc.data();\n        delete userData.hashedPassword;\n\n        resultArray.push(userData);\n      });\n\n      return resultArray;\n    });\n};\n\n\nconst searchSuggested = () => {\n  return db.collection('users').limit(60).get().then((snapshot) => {\n    const result = {};\n    snapshot.forEach((doc) => {\n      const userData = doc.data();\n      delete userData.hashedPassword;\n\n      result[userData.username] = userData;\n    });\n\n    return result;\n  });\n};\n\n\nconst getUsersWithNotificationToken = () => {\n  return db.collection('users').where('notificationToken', '>', '').get()\n    .then((snapshot) => {\n      const result = {};\n      snapshot.forEach((doc) => {\n        const userData = doc.data();\n        delete userData.hashedPassword;\n\n        result[userData.username] = userData;\n      });\n      return result;\n    });\n};\n\n\nmodule.exports = { searchForUsers, searchSuggested, getUsersWithNotificationToken };\n"]}